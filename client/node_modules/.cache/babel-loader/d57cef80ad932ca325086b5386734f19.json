{"ast":null,"code":"import _asyncToGenerator from\"/Users/ruchikaashokbharati/Documents/Projects/Ecommerce/Ecommerce-Backend-main/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/Users/ruchikaashokbharati/Documents/Projects/Ecommerce/Ecommerce-Backend-main/client/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState,useEffect}from'react';import{Link}from'react-router-dom';import MetaData from'../layouts/MetaData';import{useAlert}from'react-alert';import{useDispatch,useSelector}from'react-redux';import CheckoutSteps from\"./checkoutSteps\";import{createOrder,clearErrors}from'../../actions/orderActions';import{useStripe,useElements,CardNumberElement,CardExpiryElement,CardCvcElement}from'@stripe/react-stripe-js';import axios from\"axios\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var options={style:{base:{fontSize:'16px'},invalid:{color:'#9e2146'}}};var Payment=function Payment(_ref){var history=_ref.history;var alert=useAlert();var stripe=useStripe();var elements=useElements();var dispatch=useDispatch();var _useSelector=useSelector(function(state){return state.auth;}),user=_useSelector.user;var _useSelector2=useSelector(function(state){return state.cart;}),cartItems=_useSelector2.cartItems,ShippingInfo=_useSelector2.ShippingInfo;var _useSelector3=useSelector(function(state){return state.order;}),error=_useSelector3.error;var order={orderItems:cartItems,ShippingInfo:ShippingInfo};var orderInfo=JSON.parse(sessionStorage.getItem(\"orderInfo\"));if(orderInfo){order.itemsPrice=orderInfo.itemPrice;order.shippingPrice=orderInfo.shippingPrice;order.taxPrice=orderInfo.taxPrice;order.totalPrice=orderInfo.totalPrice;}var paymentData={amount:Math.round(orderInfo.totalPrice*100)};useEffect(function(){if(error){alert.error(error);dispatch(clearErrors());}},[dispatch,error,error]);var submitHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var res,config,clientSecret,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();console.log(\"amount\",Math.round(orderInfo.totalPrice*100));console.log(\"orderInfo\",orderInfo);console.log(\"paymentData\",paymentData);console.log(\"im in submit handler\");document.querySelector(\"#pay_btn\").disabled=true;config={headers:{'Content-Type':'application/json'}};// res = await axios.post('/api/v1/payment/process', paymentData, config)\n_context.next=9;return axios.post(\"/user/payment\",paymentData,config);case 9:res=_context.sent;console.log(\"res\",res);clientSecret=res.data.client_secret;if(!(!stripe||!elements)){_context.next=14;break;}return _context.abrupt(\"return\");case 14:_context.next=16;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardNumberElement),billing_details:{name:user.name,email:user.email}}});case 16:result=_context.sent;console.log(\"paymentIntent\",result.paymentIntent);if(result.error){console.log(\"im in result errpr\");alert.error(result.error.message);document.querySelector(\"#pay_btn\").disabled=false;}else{if(result.paymentIntent.status==\"succeeded\"){order.paymentInfo={id:result.paymentIntent.id,status:result.paymentIntent.status};dispatch(createOrder(order));history.push(\"/success\");}else{alert.error(\"there is some issue while payment processing\");}}console.log(clientSecret);try{}catch(error){document.querySelector(\"#pay_btn\").disabled=false;alert.error(error.response.data.message);}case 21:case\"end\":return _context.stop();}}},_callee);}));return function submitHandler(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(MetaData,{title:'Payment'}),/*#__PURE__*/_jsx(CheckoutSteps,{shipping:true,confirmOrder:true,payment:true}),/*#__PURE__*/_jsx(\"div\",{className:\"row wrapper\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-10 col-lg-5\",children:/*#__PURE__*/_jsxs(\"form\",{className:\"shadow-lg\",onSubmit:submitHandler,children:[/*#__PURE__*/_jsx(\"h1\",{className:\"mb-4\",children:\"Card Info\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card_num_field\",children:\"Card Number\"}),/*#__PURE__*/_jsx(CardNumberElement,{type:\"text\",id:\"card_num_field\",className:\"form-control\",options:options})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card_exp_field\",children:\"Card Expiry\"}),/*#__PURE__*/_jsx(CardExpiryElement,{type:\"text\",id:\"card_exp_field\",className:\"form-control\",options:options})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card_cvc_field\",children:\"Card CVC\"}),/*#__PURE__*/_jsx(CardCvcElement,{type:\"text\",id:\"card_cvc_field\",className:\"form-control\",options:options})]}),/*#__PURE__*/_jsxs(\"button\",{id:\"pay_btn\",type:\"submit\",className:\"btn btn-block py-3\",children:[\"Pay \",\"-\".concat(orderInfo&&orderInfo.totalPrice)]})]})})})]});};export default Payment;","map":{"version":3,"sources":["/Users/ruchikaashokbharati/Documents/Projects/Ecommerce/Ecommerce-Backend-main/client/src/components/cart/Payment.js"],"names":["React","useState","useEffect","Link","MetaData","useAlert","useDispatch","useSelector","CheckoutSteps","createOrder","clearErrors","useStripe","useElements","CardNumberElement","CardExpiryElement","CardCvcElement","axios","options","style","base","fontSize","invalid","color","Payment","history","alert","stripe","elements","dispatch","state","auth","user","cart","cartItems","ShippingInfo","order","error","orderItems","orderInfo","JSON","parse","sessionStorage","getItem","itemsPrice","itemPrice","shippingPrice","taxPrice","totalPrice","paymentData","amount","Math","round","submitHandler","e","preventDefault","console","log","document","querySelector","disabled","config","headers","post","res","clientSecret","data","client_secret","confirmCardPayment","payment_method","card","getElement","billing_details","name","email","result","paymentIntent","message","status","paymentInfo","id","push","response"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { Link } from 'react-router-dom'\nimport MetaData from '../layouts/MetaData';\nimport { useAlert } from 'react-alert'\nimport { useDispatch, useSelector } from 'react-redux'\nimport CheckoutSteps from \"./checkoutSteps\";\nimport { createOrder, clearErrors } from '../../actions/orderActions';\nimport { useStripe, useElements, CardNumberElement, CardExpiryElement, CardCvcElement } from '@stripe/react-stripe-js';\nimport axios from \"axios\";\nconst options = {\n  style: {\n    base: {\n      fontSize: '16px'\n    },\n    invalid: {\n      color: '#9e2146'\n    }\n  }\n}\nconst Payment = ({ history }) => {\n  const alert = useAlert();\n  const stripe = useStripe();\n  const elements = useElements();\n  const dispatch = useDispatch();\n  const { user } = useSelector(state => state.auth);\n  const { cartItems, ShippingInfo } = useSelector(state => state.cart);\n  const { error } = useSelector(state => state.order);\n  const order = {\n    orderItems: cartItems,\n    ShippingInfo\n  }\n  const orderInfo = JSON.parse(sessionStorage.getItem(\"orderInfo\"))\n  if (orderInfo) {\n    order.itemsPrice = orderInfo.itemPrice\n    order.shippingPrice = orderInfo.shippingPrice\n    order.taxPrice = orderInfo.taxPrice\n    order.totalPrice = orderInfo.totalPrice\n  }\n  const paymentData = {\n    amount: Math.round(orderInfo.totalPrice * 100)\n  }\n  useEffect(() => {\n    if (error) {\n      alert.error(error)\n      dispatch(clearErrors());\n    }\n  }, [dispatch, error, error])\n  const submitHandler = async (e) => {\n    e.preventDefault();\n    console.log(\"amount\", Math.round(orderInfo.totalPrice * 100));\n    console.log(\"orderInfo\", orderInfo);\n    console.log(\"paymentData\", paymentData)\n    console.log(\"im in submit handler\");\n    document.querySelector(\"#pay_btn\").disabled = true;\n    let res;\n    const config = {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }\n    // res = await axios.post('/api/v1/payment/process', paymentData, config)\n    res = await axios.post(\"/user/payment\", paymentData, config);\n    console.log(\"res\", res);\n    const clientSecret = res.data.client_secret;\n    if (!stripe || !elements) {\n      return;\n    }\n    const result = await stripe.confirmCardPayment(clientSecret, {\n      payment_method: {\n        card: elements.getElement(CardNumberElement),\n        billing_details: {\n          name: user.name,\n          email: user.email\n        }\n      }\n    })\n    console.log(\"paymentIntent\", result.paymentIntent);\n    if (result.error) {\n      console.log(\"im in result errpr\");\n      alert.error(result.error.message);\n      document.querySelector(\"#pay_btn\").disabled = false;\n    } else {\n      if (result.paymentIntent.status == \"succeeded\") {\n        order.paymentInfo = {\n          id: result.paymentIntent.id,\n          status: result.paymentIntent.status\n        }\n        dispatch(createOrder(order))\n        history.push(\"/success\")\n      } else {\n        alert.error(\"there is some issue while payment processing\");\n      }\n    }\n    console.log(clientSecret);\n    try {\n\n    } catch (error) {\n      document.querySelector(\"#pay_btn\").disabled = false;\n      alert.error(error.response.data.message);\n    }\n  }\n  return (\n    <>\n      <MetaData title={'Payment'} />\n      <CheckoutSteps shipping confirmOrder payment></CheckoutSteps>\n      <div className=\"row wrapper\">\n        <div className=\"col-10 col-lg-5\">\n          <form className=\"shadow-lg\" onSubmit={submitHandler}>\n            <h1 className=\"mb-4\">Card Info</h1>\n            <div className=\"form-group\">\n              <label htmlFor=\"card_num_field\">Card Number</label>\n              <CardNumberElement\n                type=\"text\"\n                id=\"card_num_field\"\n                className=\"form-control\"\n                options={options}\n              />\n            </div>\n\n            <div className=\"form-group\">\n              <label htmlFor=\"card_exp_field\">Card Expiry</label>\n              <CardExpiryElement\n                type=\"text\"\n                id=\"card_exp_field\"\n                className=\"form-control\"\n                options={options} />\n            </div>\n\n            <div className=\"form-group\">\n              <label htmlFor=\"card_cvc_field\">Card CVC</label>\n              <CardCvcElement\n                type=\"text\"\n                id=\"card_cvc_field\"\n                className=\"form-control\"\n                options={options}\n              />\n            </div>\n\n\n            <button\n              id=\"pay_btn\"\n              type=\"submit\"\n              className=\"btn btn-block py-3\"\n            >\n              Pay {`-${orderInfo && orderInfo.totalPrice}`}\n            </button>\n\n          </form>\n        </div>\n      </div>\n    </>\n  )\n}\n\nexport default Payment\n"]},"metadata":{},"sourceType":"module"}